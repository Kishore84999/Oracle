SELECT PAPF.PERSON_NUMBER
,to_char(PAPF.EFFECTIVE_START_DATE,'YYYY/MM/DD') START_DATE
,TO_CHAR(PAPF.EFFECTIVE_END_DATE,'YYYY/MM/DD') END_DATE
,EMAIL.EMAIL_ADDRESS
,PPNF.FIRST_NAME
,PPNF.LAST_NAME
,PPNF.TITLE
,PPNF.MIDDLE_NAMES
,PPNF.KNOWN_AS
,NATIONAL_IDENTIFIER_NUMBER
FROM PER_ALL_PEOPLE_F PAPF
,PER_EMAIL_ADDRESSES EMAIL
,PER_PERSON_NAMES_F PPNF
,PER_NATIONAL_IDENTIFIERS NID

WHERE nvl(:EFFECTIVE_DATE,sysdate) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE
AND nvl(:EFFECTIVE_DATE,sysdate) BETWEEN PPNF.EFFECTIVE_START_DATE AND PPNF.EFFECTIVE_END_DATE
AND PAPF.PRIMARY_EMAIL_ID = EMAIL.EMAIL_ADDRESS_ID
AND PAPF.PERSON_ID = PPNF.PERSON_ID
AND PAPF.PRIMARY_NID_ID = NID.NATIONAL_IDENTIFIER_ID
AND PPNF.NAME_TYPE = 'GLOBAL'
and papf.person_number = NVL(:P_PERSON_NO,papf.person_number)
/

SELECT count(PAPF.PERSON_NUMBER)
FROM PER_ALL_PEOPLE_F PAPF
,PER_EMAIL_ADDRESSES EMAIL
,PER_PERSON_NAMES_F PPNF
,PER_NATIONAL_IDENTIFIERS NID

WHERE nvl(:EFFECTIVE_DATE,sysdate) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE
AND nvl(:EFFECTIVE_DATE,sysdate) BETWEEN PPNF.EFFECTIVE_START_DATE AND PPNF.EFFECTIVE_END_DATE
AND PAPF.PRIMARY_EMAIL_ID = EMAIL.EMAIL_ADDRESS_ID
AND PAPF.PERSON_ID = PPNF.PERSON_ID
AND PAPF.PRIMARY_NID_ID = NID.NATIONAL_IDENTIFIER_ID
AND PPNF.NAME_TYPE = 'GLOBAL'
and papf.person_number = NVL(:P_PERSON_NO,papf.person_number)
group by papf.PERSON_NUMBER